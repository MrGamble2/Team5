<html>
<head>
<!-- Your application's stylesheet -->
<link href="your-app-css">
<!-- Ellucian Design System -->
<link href=".../ellucian-design-system-ltr.css">
<!-- Your custom extensions -->
<link href="style.css">

<link href="https://cdn.elluciancloud.com/assets/1.1.7/css/ellucian-design-system-ltr.min.css" rel="stylesheet"/>
<link rel="stylesheet" type="text/css" href="style.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<div class="dropdown">
  <button class="dropbtn">Navigation</button>
  <div class="dropdown-content">
    <a href="Account.html">My Account</a>
    <a href="Search.html">Buy Book</a>
    <a href="SellBook.html">Sell Book</a>
	<a href="MyBooks.html">My Books</a>
	<a href="Login.html">Log Out</a>
  </div>
</div>

<body onload="GetCourses()">
	<div class="esg-form__group">
		<label class="esg-form__label esg-is-required" for="email">Course Search:</label>
		<input id="courseID" class="esg-form__input" type="text" placeholder="Search for a Course" id="email"/>
	</div>
	<select id = "dropdown" onchange="fillSearch()"></select>

	<button class="esg-button esg-button--primary" type="button" onclick="GetBook()">Search</button>
    <script type="text/javascript">
    	function addDropDown(json)
          {
              select = document.getElementById('dropdown');
              
              for(var i = 0; i < json.length; i++){
              		if(i == 0){
              			document.getElementById('courseID').value = json[i].id;
              		}
                  var opt = document.createElement('option');
                  opt.value = json[i].id;
                  opt.innerHTML = json[i].id;
                  select.appendChild(opt);
             }
         }

         function addRows(json){
         	var table = document.getElementById('booksForCourseTable');

         	table.rows[1].cells[0].innerHTML = ""
			    table.rows[1].cells[1].innerHTML = "";
			    table.rows[1].cells[2].innerHTML = "";
			    table.rows[1].cells[3].innerHTML = "";

			    table.rows[2].cells[0].innerHTML = ""
			    table.rows[2].cells[1].innerHTML = "";
			    table.rows[2].cells[2].innerHTML = "";
			    table.rows[2].cells[3].innerHTML = "";

			    table.rows[3].cells[0].innerHTML = ""
			    table.rows[3].cells[1].innerHTML = "";
			    table.rows[3].cells[2].innerHTML = "";
			    table.rows[3].cells[3].innerHTML = "";



         	for(var i = 0; i < json.length; i++){
			    table.rows[i + 1].cells[0].innerHTML = json[i].title;
			    table.rows[i + 1].cells[1].innerHTML = json[i].condition;
			    table.rows[i + 1].cells[2].innerHTML = json[i].price;
			    table.rows[i + 1].cells[3].innerHTML = json[i].seller;
            }
         }

         function fillSearch(){
         	document.getElementById('courseID').value = document.getElementById('dropdown').value;
         }

        function GetBook(){
            var textresponse = requestAPI();
            var jsonresponse = JSON.parse(localStorage.getItem("books"));
            PopulateTables();
        }
        function GetCourses(){
			var userUni = localStorage.getItem('university');
			var url = "http://localhost:3000/university?univName="+userUni;
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(){
                if(xhr.readyState == 4 && xhr.status == 200){
                    textRES = JSON.parse(xhr.responseText);
					localStorage.setItem('courses',textRES);
					addDropDown(textRES);
                }
            }
			xhr.open('GET', url);
            xhr.send();
		}
        function requestAPI(){
            var courseID = document.getElementById('courseID').value;
            var url = "http://localhost:3000/book?id="+courseID;
            var xhr = new XMLHttpRequest();
    
            xhr.onreadystatechange = function(){
                if(xhr.readyState == 4 && xhr.status == 200){
                    var textRES = xhr.responseText;
                    var fieldNameElement = document.getElementById('textField');
					var bookJSON = JSON.parse(textRES);
                    localStorage.setItem('books', textRES);
                    addRows(bookJSON);
                }
            }
            xhr.open('GET', url);
            xhr.send();
        }
        function PopulateTables(jsonresponse){
        
        }

        $(document).ready(function() {

		    $('#booksForCourseTable td').click(function() {
			    var rowIndex = $(this).parent().parent().children().index($(this).parent());

			    var table = document.getElementById('booksForCourseTable');
			    var book = table.rows[rowIndex + 1].cells[0].innerHTML;
			    var price = table.rows[rowIndex + 1].cells[2].innerHTML;
			    var buyer = localStorage.getItem("userName");
			    var buyerEmail = localStorage.getItem("userEmail");

			    window.location.href = "mailto:" + buyerEmail + "?subject=BuyerRequest&body=" + buyer + " would like to buy " + book + " for " + price;

		    });
		});

        </script>

	<div class="esg-table__container">
		<div class="esg-table-actions">
			<div class="esg-h5 esg-table-actions__title">Books
			</div>
			<span class="esg-badge esg-badge--success">3</span>

		</div>

		<table id="booksForCourseTable" class="esg-table">
			<thead class="esg-table-head">
			<tr class="esg-table-head__row">

				<th class="esg-table-head__th" colspan="2">
					<button class="esg-table-head__button" id="dataTableFilter1" data-placeholder="false" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">Book Info</button>
				</th>

				<th class="esg-table-head__th">
					<button class="esg-table-head__button" id="dataTableFilter2" data-placeholder="false" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">Condition</button>
				</th>

				<th class="esg-table-head__th">
					<button class="esg-table-head__button" id="dataTableFilter3" data-placeholder="false" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">Price</button>
				</th>

				<th class="esg-table-head__th">
					<button class="esg-table-head__button" id="dataTableFilter4" data-placeholder="false" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">Contact Seller</button>
				</th>
			</tr>
			</thead>
			<tbody class="esg-table-body"">
				<tr class="esg-table-body__row">
					<td class="esg-table-body__td" colspan="2"> </td>
					<td class="esg-table-body__td"></td>
					<td class="esg-table-body__td"></td>
					<td class="esg-table-body__td"><span class="esg-label esg-label--pending"> </span></td>
					</tr>

					<tr class="esg-table-body__row">
					<td class="esg-table-body__td" colspan="2"> </td>
					<td class="esg-table-body__td"></td>
					<td class="esg-table-body__td"></td>
					<td class="esg-table-body__td"><span class="esg-label esg-label--pending"></span></td>
					</tr>

					<tr class="esg-table-body__row">
					<td class="esg-table-body__td" colspan="2"></td>
					<td class="esg-table-body__td"></td>
					<td class="esg-table-body__td"></td>
					<td class="esg-table-body__td"><span class="esg-label esg-label--pending"> </span></td>
				</tr>
			</tbody>
		</table>
	</div>
</body>
</html>
